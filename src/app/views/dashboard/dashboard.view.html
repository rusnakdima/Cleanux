<div class="dashboard-container">
  <!-- Header Section -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold tracking-tight">System Dashboard</h1>
      <p class="text-gray-500 dark:text-gray-400 mt-1">
        Overview of your computer's health and junk files.
      </p>
    </div>
    <div class="status-indicator">
      <div
        class="status-dot animate-pulse"
        [class.bg-emerald-500]="systemStatus() === 'Healthy'"
        [class.bg-amber-500]="systemStatus() === 'Needs Attention'"
        [class.bg-rose-500]="systemStatus() === 'Critical'"
      ></div>
      <span class="text-sm font-bold tracking-wide uppercase text-slate-800 dark:text-slate-200">{{
        systemStatus()
      }}</span>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    <!-- Health Score -->
    <div class="dashboard-card">
      <span class="card-label">System Health</span>
      <div class="chart-container">
        <svg class="w-full h-full -rotate-90">
          <circle
            cx="56"
            cy="56"
            r="48"
            stroke="currentColor"
            stroke-width="12"
            fill="transparent"
            class="chart-bg-circle"
          />
          <circle
            cx="56"
            cy="56"
            r="48"
            stroke="currentColor"
            stroke-width="12"
            fill="transparent"
            [attr.stroke-dasharray]="301.6"
            [attr.stroke-dashoffset]="301.6 - (301.6 * healthScore()) / 100"
            class="transition-all duration-1000 ease-out"
            [class.text-emerald-500]="healthScore() >= 80"
            [class.text-amber-500]="healthScore() >= 50 && healthScore() < 80"
            [class.text-rose-500]="healthScore() < 50"
          />
        </svg>
        <span class="chart-value">{{ healthScore() }}%</span>
      </div>
    </div>

    <!-- Junk Found -->
    <div class="dashboard-card delay-100">
      <span class="card-label">Storage Cleanup</span>
      <div class="junk-value-container">
        <span class="junk-value-large">{{ formatSize(totalJunkSize()).split(" ")[0] }}</span>
        <span class="junk-value-unit">{{ formatSize(totalJunkSize()).split(" ")[1] }}</span>
      </div>
      <mat-icon class="text-indigo-500 text-3xl">auto_delete</mat-icon>
    </div>

    <!-- System Status -->
    <div class="dashboard-card delay-200 text-center">
      <span class="card-label">Recommendation</span>
      <p class="font-semibold text-slate-600 dark:text-slate-400">
        @if (systemStatus() === "Healthy") {
          Everything is looking great!
        } @else if (systemStatus() === "Needs Attention") {
          Clean up to optimize performance.
        } @else {
          System performance is impacted.
        }
      </p>
      @if (totalJunkSize() > 0 && !isScanning() && !isCleaning()) {
        <button (click)="cleanAll()" class="clean-btn">
          <mat-icon class="text-xl">cleaning_services</mat-icon>
          Deep Clean
        </button>
      } @else if (isCleaning()) {
        <div class="flex items-center gap-3 text-indigo-600 font-bold animate-pulse">
          <mat-icon class="animate-spin">sync</mat-icon>
          Cleaning...
        </div>
      }
    </div>
  </div>

  <!-- Main Scan Action -->
  <div class="scan-section min-h-[400px]">
    <div class="relative flex items-center justify-center p-10">
      <!-- Outer Progress Circle -->
      <div class="absolute w-[290px] h-[290px] pointer-events-none">
        <svg class="w-full h-full -rotate-90" viewBox="0 0 256 256">
          <!-- Subtle track -->
          <circle
            cx="128"
            cy="128"
            r="122"
            stroke="currentColor"
            stroke-width="2"
            fill="transparent"
            class="text-slate-200 dark:text-slate-800/30"
          />

          @if (isScanning()) {
            <!-- Progress indicator -->
            <circle
              cx="128"
              cy="128"
              r="122"
              stroke="currentColor"
              stroke-width="6"
              fill="transparent"
              stroke-linecap="round"
              [attr.stroke-dasharray]="766.5"
              [attr.stroke-dashoffset]="766.5 - (766.5 * scanProgress()) / 100"
              class="text-indigo-600 transition-all duration-300 scan-progress-ring"
            />
          }
        </svg>
      </div>

      <!-- Scan Button -->
      <button
        (click)="startScan()"
        [disabled]="isScanning() || isCleaning()"
        class="scan-btn z-10"
        [class.scan-btn-scanning]="isScanning()"
      >
        <div class="flex flex-col items-center justify-center p-4">
          <mat-icon class="scan-icon m-0!" [class.animate-bounce]="isScanning()">
            {{ isScanning() ? "searching" : "speed" }}
          </mat-icon>
          <span class="scan-text mt-4">
            {{ isScanning() ? "Scanning..." : "Start Scan" }}
          </span>
          @if (isScanning()) {
            <span class="scan-percentage mt-1 font-black"
              >{{ scanProgress() | number: "1.0-0" }}%</span
            >
          }
        </div>
      </button>
    </div>
  </div>
</div>
